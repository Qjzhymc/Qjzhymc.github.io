---
title: Redis面试题
author: Yu Mengchi
categories:
  - Interview
  - 面试知识点
  - 数据库
tags:
  - Interview
  - Redis
---
# Redis面试题

### Redis的架构

### Redis为什么快？
- 基于内存
- 基于reactor模式的事件处理模型，主要是单线程事件循环和IO多路复用
- 优化后的数据结构

### redis线程模式
Redis 基于 Reactor 模式开发了自己的文件事件处理器（file event handler）。
- 文件事件处理器使用 I/O 多路复用（multiplexing）程序来同时监听多个套接字，并根据套接字执行的任务来为套接字关联不同的事件处理器。
- 当被监听的套接字准备好执行连接应答（accept）、读取（read）、写入（write）、关 闭（close）等操作时，与操作相对应的文件事件就会产生，这时文件事件处理器就会调用套接字之前关联好的事件处理器来处理这些事件。

> 虽然文件事件处理器以单线程方式运行，但通过使用 I/O 多路复用程序来监听多个套接字，文件事件处理器既实现了高性能的网络通信模型，又可以很好地与 Redis 服务器中其他同样以单线程方式运行的模块进行对接，这保持了 Redis 内部单线程设计的简单性。

> 通过IO多路复用模型连接多个客户端，通过文件事件处理器分配事件处理。

### redis为什么设计成单线程？
避免了多线程并发带来的复杂性和开销。因为reids的大部分操作都是内存操作，而非磁盘操作，因此
单线程处理能够完全充分利用cpu的性能。单线程可以避免锁和上下文切换等多线程并发带来的开销，
而且，redis还采用了非阻塞io模型，可以处理大量并发连接。

### 文件事件处理器组成
- 多个socket套接字
- IO多路复用程序
- 文件事件分派器
- 多种事件处理器（命令请求处理器、命令回复处理器、连接应答处理器、主从连接处理器）

### Redis的数据结构有哪些？
- String：SDS
- Hash
- List
- Set
- ZSet

### rdb和aof两种持久化机制比较？AOF重写？
- RDB： 对内存中数据创建副本，创建快照副本可以用redis提供的两个命令，save命令是由主线程执行；bgsave命令是由子线程执行，不会阻塞主线程。
- AOF：每次执行对数据更改的命令，会把该命令先写入缓存文件，在根据不同的策略（每秒一次）写入到磁盘中的AOF文件。主流持久化方式，可以把缓存设置为每秒写入磁盘一次。

> AOF重写：执行BGREWRITEAOF命令的时候，创建新AOF文件时，会同时创建一个缓存区，保存这个期间服务器执行的写命令，然后把缓冲区内容加入新AOF文件，最后用新的AOF文件替换旧的AOF文件。

- RDB存储的是压缩后的二进制文件，文件比较小。使用RDB恢复数据时直接解析还原数据就行，比较快，不需要一条条执行命令。
- AOF优点在于保存的是命令，可以快速持久化，支持每秒同步一次，操作比较轻量。

### redis如何使用事务？
可以使用MULTI和EXEC命令开启事务，
输入MULTI之后，redis会把后面的命令加入队列，不会立即执行。
再输入EXEC命令后会一次所有的执行。
watch key：监视一个key，如果在事务执行之前这个key被其他事务改动，那么事务就会被打断。
### Redis的几种部署方式？

### 缓存更新策略有哪几种？内存淘汰机制？
- volatile-lru
- volatile-ttl
- volatile-random
- allkeys-lru
- allkeys-random
- no-eviction

4.0版本后增加了两种：
- volatile-lfu
- allkeys-lfu

### 常见的缓存读写策略有哪些？

### 缓存过期后处理策略？删除策略？
- 惰性删除
- 定期删除

> redis采用惰性删除+定期删除

### 如何判断缓存过期？

### 项目中是如何使用redis的？redis使用场景有哪些？
1. 缓存：存储经常访问的数据，以便更快的访问它们，提高应用程序性能
2. 会话存储：在多个服务器之间共享会话数据
3. 消息队列：在应用程序之间传递消息
4. 计数器：跟踪应用程序中发生的事件数量。

### 缓存穿透
指大量请求的key不存在缓存中，也不存在于数据库中，就会导致大量请求落到数据库中，对数据库造成比较大的压力。
比如黑客会故意制造一些非法的key发出大量请求。
解决方法就是通过布隆过滤器判断key是否合法，具体做法是：把所有可能存在的请求的值都存放在布隆过滤器中，当用户请求过来，先判断用户发来的
请求的值是否存在于布隆过滤器中，如果不存在的话，直接返回请求参数错误信息返回给客户端，存在的话就走下面的流程。

### 缓存击穿
指请求的key对应的是热点数据，这些数据存在于数据库中，但是不存在于缓存中，这就会导致大量的请求直接到数据库中，对数据库造成巨大的压力。  
解决方法设置针对热点数据永不过期或过期时间比较长。
另外就是针对热点数据提前预热，将它存入缓存中并设置合理的过期时间。

### 缓存雪崩
指缓存在同一时间大面积的失效，导致大量的请求都直接落到数据库上，对数据库造成巨大的压力。或者是缓存服务本身宕机，导致雪崩。

解决方法：如果是redis服务自身不可用，可以采用redis集群，避免单机出现问题导致整个缓存服务没办法使用。
如果是热点缓存大面积同时失效，可以设置不同的失效时间，比如随机设置缓存的失效时间。或者设置二级缓存。

### 如何保证缓存和数据库数据的一致性？

### 如何使用redis实现分布式锁？
1. 加锁：set key value nx ex 30
2. 解锁：del key

存在的问题：当设置key之后，没有设置过期时间，导致锁没法释放，就会出现死锁了。

### redis哨兵是什么？如何使用哨兵？
哨兵会监控集群内主从节点的运行状态，当主节点宕机，会自动从从节点选举出新的主节点。
实现redis的高可用性

### redis的管道是什么？如何使用管道提高性能？
redis支持管道，客户端可以一次发送多条命令，最后一起读取返回结果，这样只需要一次网络开销，速度就
会得到提升，主要是解决网络io的性能问题。

### redis的Lua脚本是什么？为什么有Lua脚本？怎么使用？什么情况下使用？
Lua脚本是一种编写在redis服务器上的脚本语言，用于执行一系列的redis命令。
可以用于实现事务、锁、计数器等功能

### redis的Lua脚本配合set nx命令实现分布式锁？
脚本放在redis服务端，客户端通过EVAL命令执行脚本，获取锁。

### redis的发送/订阅模式是什么？什么情况使用？怎么使用？

### redis的限流是什么？如何实现限流？
限流算法有：
1. 漏斗算法
2. 令牌桶算法

- 单机限流可以使用Guava的RateLimiter对某个接口实现限流。

- 如果是集群限流，需要使用分布式限流工具，比如Sentinel。

### 如何保证redis高可用性？

1. 主从复制
2. sentinel集群
3. redis cluster分片：数据分片、多副本机制

