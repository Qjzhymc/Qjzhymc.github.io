---
title: Kubernetes&Docker编程
author: Yu Mengchi
categories:
  - Interview 
  - 面试知识点
  - 计算机基础
tags:
  - Interview
---
### 什么是 Kubernetes？它的主要作用是什么？

自动化部署、管理容器化应用程序的平台。

主要作用：
1. 自动化部署：可以通过配置文件定义和部署应用，支持滚动更新、蓝绿部署等多种部署策略
2. 水平扩展：根据负载情况自动增加或减少实例的数量
3. 自动重启：当容器失败时，可以自动重启
4. 自动回滚
5. 服务发现和负载均衡：

---
### 应用场景

用在运维工作中的服务监控、业务快速部署、服务启动停止等环节中。

1. 微服务架构：适合用于部署和管理微服务架构中的各个服务，提供了服务发现、负载均衡、自我修复功能，简化了微服务的管理和运维；
2. CICD：自动化部署流程，实现从代码提交到生产环境部署的全自动化流程，提高软件发布的速度；
3. 弹性伸缩：可以基于CPU使用率或其他自定义指标自动调整实例的数量，应对流量的变化；

---
### deployment是什么？service是什么？pod是什么？

1. deployment：管理一组pod实例，自动处理pod的创建和删除，确保指定数量的pod副本始终处于运行状态，支持滚动更新，提供回滚机制
2. service：定义了一组pod和访问策略，提供了一个稳定的ip地址和dns名称，是客户端可以通过固定的服务地址访问应用，主要做服务发现和负载均衡，将流量分配给后端的多个pod；
3. pod：是kubernetes中最小的可部署单元，代表了集群中运行的一个或多个容器，pod中的所有容器贡献相同的网络命名空间、ip地址和存储卷，并且可以相互通信。

---
### 你熟悉 Kubernetes 中哪些核心对象？每个对象都代表了什么？

在Kubernetes中，核心对象是用于定义集群状态和资源的基本构建块。这些对象描述了你希望集群呈现的状态，包括运行哪些应用程序、它们应该如何连接、服务发现机制、存储需求等。以下是Kubernetes中一些关键的核心对象及其代表的意义：

1. **Pod**
- **代表**：最小的可部署单元。
- **说明**：一个Pod可以包含一个或多个容器（通常是一个），这些容器共享存储、网络以及如何运行的规范。Pod提供了一个抽象层，使得容器可以在同一主机上共同工作。

2. **Service**
- **代表**：一组Pod的访问策略及其实现方式。
- **说明**：Service为一组功能相同的Pod提供了一个固定的IP地址和DNS名称，并负责负载均衡到这些Pod。它允许应用组件之间进行通信，即使它们可能分布在不同的节点上。

3. **Deployment**
- **代表**：管理无状态应用的声明性更新。
- **说明**：Deployment提供了一种管理Pod副本集的方法，支持滚动更新、回滚等功能。它是维护应用程序期望状态的关键对象，比如确保一定数量的Pod副本正在运行。

4. **StatefulSet**
- **代表**：管理有状态应用的工作负载。
- **说明**：与Deployment不同，StatefulSet为每个Pod维护一个持久标识符，并保证Pod启动和终止顺序的一致性。适用于需要稳定持久化存储的应用程序，如数据库。

5. **DaemonSet**
- **代表**：确保所有（或部分）节点运行一个特定的Pod副本。
- **说明**：当需要在集群中的每个节点（或满足某些条件的节点）上运行一个守护进程时使用。例如，日志收集器或监控代理通常通过DaemonSet部署。

6. **Job**
- **代表**：执行一次性任务。
- **说明**：Job创建一个或多个Pod，并确保指定数量的任务成功完成。适用于批处理作业或定时任务。

7. **CronJob**
- **代表**：定期执行的任务。
- **说明**：类似于Linux系统的cron工具，CronJob根据时间表周期性地创建Jobs，非常适合安排定期维护任务或其他重复性操作。

8. **ConfigMap 和 Secret**
- **代表**：
  - **ConfigMap**：用来保存配置数据的键值对，供Pod使用。
  - **Secret**：专门用于存储敏感信息，如密码、OAuth令牌等。
- **说明**：两者都提供了将配置信息与容器镜像解耦合的方式，便于管理和更新配置而不必重建镜像。

9. **PersistentVolume (PV) 和 PersistentVolumeClaim (PVC)**
- **代表**：
  - **PV**：集群中的一段存储，由管理员配置。
  - **PVC**：用户对存储的请求。
- **说明**：PV提供了一种独立于具体应用的方式来管理存储资源，而PVC则让开发者能够请求所需的存储容量，无需关心底层实现细节。

这些核心对象共同作用，帮助用户定义和管理复杂的分布式系统，使Kubernetes成为现代云原生应用开发的重要工具。通过组合使用这些对象，可以灵活地构建、扩展和维护各种类型的应用程序和服务。

---
### 部署一个应用程序时，Pod 的作用是什么？

pod是最小的可部署单元，可以封装一个或多个容器。这些容器共享存储、网络、以及怎么运行这些容器的规约。
当pod创建时，会被调度在集群中的节点上运行。


---
### 描述一下 Deployment 和 StatefulSet 的区别和使用场景。

1. deployment主要用于管理无状态应用，每个实例都是相同的；
- 无状态应用；
- 支持自动化的滚动更新和回滚
- 通过指定pod副本数量
- pod之间没有固定的网络标识，通常依赖于service

2. statefulSet为有状态应用设计的，比如数据库、分布式文件系统，这些应用通常需要稳定的网络身份标识，也就是固定的主机名、持久化存储。
- 有状态应用
- 稳定的身份标识：每个pod都有一个唯一的、稳定的网络标识符，即使pod被重新调度也不会改变；
- 持久化存储：每个pod可以关联一个或多个persistentVolumeClaim，而且这些卷会随着pod的生命周期保持一致；
- 有序的操作：部署、扩展、更新和删除的操作需要遵循一定的顺序，保证数据的一致性和可靠性；

总结：
- 如果应用是无状态的，并且希望简单的部署、升级和扩展，使用deployment
- 如果应用是有状态的，并且需要持久化存储、稳定的网络标识以及对pod操作顺序有严格要求时，使用statefulSet；

---
### Kubernetes 中的 Service 是什么？它们的作用是什么？

Service它定义了一组逻辑上的Pod及其访问策略。Service的主要作用是为一组提供相同功能的Pod提供一个固定的访问入口，并且能够在后端Pod发生变化（如增加、删除或替换）时自动更新这个访问入口的信息。

作用：
1. 负载均衡
2. 服务发现
3. 固定ip和DNS名称
4. 暴露应用

> 假设你有一个 Web 应用程序部署在 Kubernetes 集群中，由多个副本组成（例如通过 Deployment 管理）。为了确保外部用户可以稳定地访问这个应用程序，同时让请求均匀分布到所有可用的实例上，你可以创建一个 Service 来完成这项工作。该 Service 将监听来自客户端的请求，并将其分发给当前活跃的应用程序 Pod 实例。如果某个 Pod 失效或者添加了新的 Pod 实例，Service 也会相应地调整其路由规则，确保流量总是被导向到健康的服务实例上。

---
### Kubernetes 中的 ConfigMap 和 Secret 分别是做什么的？

在 Kubernetes 中，**ConfigMap** 和 **Secret** 是两种用于管理配置数据和敏感信息的资源对象。它们的主要作用是将配置与应用程序代码分离，从而提高可维护性和安全性。

**1. ConfigMap**

**作用**
- **存储非敏感的配置数据**：例如环境变量、配置文件、命令行参数等。

**常见使用场景**
- 存储应用程序的配置文件（如 `app.config` 或 `application.properties`）。
- 定义环境变量或命令行参数。
- 动态调整配置而无需重新部署应用。

**2. Secret**

**作用**
- **存储敏感信息**：例如密码、API 密钥、TLS 证书等。

**常见使用场景**
- 存储数据库连接字符串中的用户名和密码。
- 管理 API 密钥或 OAuth 令牌。
- 提供 TLS 证书以启用 HTTPS。

**总结**
- **ConfigMap**：适合存储非敏感的配置数据，便于动态更新和管理应用程序的配置。
- **Secret**：专门用于存储敏感信息，提供更高的安全性保障。

通过合理使用 ConfigMap 和 Secret，可以实现配置与代码的分离，提升应用的灵活性和安全性，同时避免敏感信息泄露的风险。

---
### 讲一下 Horizontal Pod Autoscaler (水平pod自动扩展)的工作原理。

1. 监控指标
2. 计算期望副本数：从metrics server获取实际资源使用情况，结合设定的目标值，计算所需的pod数量
3. 调整副本数
4. 冷却时间

---
### Kubernetes 中的卷（Volume）是用来做什么的？列举出几种 Kubernetes 支持的 Volume 类型。

卷是存储的抽象。

1. configMap和Secret：主要用于配置，也可以作为卷挂载到容器内，都可以通过卷的形式被容器访问。
2. PersistentVolume（PV）和PersistentVolumeClaim（PVC）：pv是集群中的一段存储资源，独立于单独的pod存在；pvc是由用户的请求用来申请存储资源。

---
### 什么是 Init Container？它们的作用是什么？

是在应用程序启动之前执行的容器，主要完成一些必要的初始化工作。所有init container必须成功退出后，pod中的普通容器才会启动。

作用：
可以再应用程序容器启动前执行一些必要的准备工作，比如检查依赖服务是否可用、等待数据库完全启动等。

---
### 如何在 Kubernetes 集群中扩展 Node？可以采取哪些方法来扩容集群？

1. 可以手动添加到集群中
- 准备新节点
- 加入集群
- 验证节点状态
2. 云平台自动扩展

---
### dockerfile写过吗？有哪些配置？

---
### Dockerfile创建的层太多了怎么办？什么命令会创建一层？

1. 合并多个RUN指令；
2. 使用多阶段构建；
3. COPY的时候，避免复制整个目录结构，只复制实际需要的文件；
4. 清理临时文件，在RUN指令后安装了软件包之后可以再删除缓存文件临时文件；

使用RUN、ADD、COPY指令都会新建一层镜像。
