---
title: 分布式面试题
author: Yu Mengchi
categories:
  - Interview 
  - 面试知识点
  - 系统设计
tags:
  - Interview
  - 分布式系统
---
  
### 有哪些分布式一致算法？分布式一致性协议？
分布式一致性算法：在一个可能发生故障的分布式系统中，如何对某个值达成共识，保证系统的一致性。
1. Paxos
- 核心思想：
  - 通过多轮提案(proposal)机制，在多个节点之间达成一致。
  - 包括三个角色：Proposer、acceptor、Learner。
  - Proposer提出提案，每个提案包含一个唯一的编号和要达成一致的值；
  - Acceptor接收或拒绝提案；
  - Learner学习已经达成一致的结果，不参与决策过程，只接收最终的结果。
  算法流程：1. Prepare阶段 2. Accept阶段
2. Raft
- 核心思想：
  - 将共识问题分解为领导选举、日志复制、安全性三个子问题。
  - 集群中有一个明确的Leader节点负责处理客户端请求，并将日志同步到其他follower节点。
- 应用场景：Etcd，Consul
3. ZAB
- 核心思想：
  - 类似于Raft，也采用Leader-follower模型，leader负责广播事务日志
  - 强调顺序性和原子性，确保所有节点按照相同的顺序执行事务
- 应用场景：ZooKeeper，用于分布式锁、配置管理、服务发现。
4. 2PC
- 核心思想：
  - 准备阶段：协调者询问所有参与者是否可以提交事务
  - 提交阶段：如果所有参与者都同意，则协调者通知提交；否则回滚
- 特点：存在单点故障
- 应用场景：MySQL的XA事务
5. 3PC
6. CRDT：用于共享白板、协同文档
7. BFT：拜占庭容错算法，区块链
8. Chord：将数据分布到一个逻辑环上，每个节点负责一部分数据，P2P文件共享系统

---
### 分布式事务解决方案？
1. 2PC
 - 原理：将事务过程分为准备(Prepare)和提交(Commit)两个阶段，由事务协调器（TM）和事务参与者（RM）共同完成
 - 准备阶段：:TM 向所有RM发送Prepare消息，RM执行事务操作，并将Undo/Redo日志写入本地，但不提交事务，并将执行结果返回给TM。
 - 提交阶段：:TM根据RM的执行结果，向所有RM发送Commit或Rollback消息。RM收到Commit消息则提交事务，收到Rollback消息则回滚事务，并释放锁资源。
2. **TCC**（try-confirm-cancel）
 - Try阶段：:尝试执行业务，预留资源。
 - Confirm阶段：:确认提交，正式操作。
 - Cancel阶段：:如果try阶段或confirm阶段有某个参与方失败，则回滚操作，释放资源。

分布式事务框架？
1. Seata
 - Transaction Coordinator (TC)：事务协调者，维护全局和分支事务的状态，驱动全局事务提交或回滚。
 - Transaction Manager (TM)：事务管理器，定义全局事务的范围：开始全局事务、提交或回滚全局事务。
 - Resource Manager (RM)：资源管理器，管理分支事务处理的资源，与TC交谈以注册分支事务和报告分支事务的状态，并驱动分支事务提交或回滚。
2. TCC Transaction

---
### 系统的CAP性质？如何保证AP和CP？
在分布式系统设计中，CAP理论指出任何网络分区下的分布式系统最多只能满足以下三个条件中的两个：

- Consistency：一致性，所有节点在同一时刻看到的数据都是相同的；
- Availability：可用性，系统是可用的，每一个请求都能接收到响应；
- Partition Tolerance：分区容忍性，即使发生了网络分区，即部分节点之间无法通信，系统仍然能够继续运行。

如何保证AP：保证AP意味着需要接收一定程度上的数据不一致。最终一致性模型
- 异步复制：主节点处理写请求，并同步到副本节点。

如何保证CP：牺牲一定的可用性，发生网络分区时，某些服务暂时不可用直到分区解决。
- 同步复制：所有写操作必须被所有副本确认后才算成功完成，保证强一致性
- Paxos/Raft算法
- 两阶段提交2PC

> 对于一致性要求极高的交易性数据采用CP模式；

> 对于用户体验影响较大但实时性要求较高的查询采用AP模式；

---
### 数据仓库和数据湖的区别？
数据湖主要存放的是非结构化或半结构化数据。例如log文件、社交媒体数据、传感器数据等。

---
### lookalike

---
### 召回-粗排-精排

---
### 对oCPM的理解

---
### 明投和暗投
主要区别在于广告主对投放渠道的控制程度；

明投是由广告主通过广告平台自主选择投放渠道，指定广告展示的媒体或关键词展示广告；

暗投是由广告平台选择投放渠道，广告主无法完全掌控实际投放渠道，需要依赖平台的流量分配机制。
