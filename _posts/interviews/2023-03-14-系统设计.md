---
title: 系统设计面试题
author: Yu Mengchi
categories:
  - Interview 
  - 面试知识点
  - 系统设计
tags:
  - Interview
  - 系统设计
---

---
### 缓存雪崩、缓存击穿、缓存穿透 分别表示什么意思？如何解决？

- 缓存穿透：大量请求的数据既不在缓存中，也不再数据库中。解决方法：布隆过滤器（用布隆过滤器先判断请求的数据在不在数据库中）；缓存空对象；参数校验与限流
- 缓存击穿：热点数据的缓存过期，导致同一时间大量对热点数据的请求直接落到数据库上。解决方法：热点数据永不过期。
- 缓存雪崩：缓存在同一时间大面积失效，导致大量的请求直接落到数据库上。比如缓存服务器宕机。解决方法：1.采用redis集群 2.限流 3.随机设置缓存失效时间 4. 设置二级缓存

---
### 项目中如何使用缓存的？如何更新缓存？缓存过期怎么办？

本地缓存使用Guava Cache。

分布式缓存使用Redis

缓存策略，什么时候创建缓存：
1. 读时缓存：查询的时候如果未命中，查询数据库并写入缓存
2. 写时缓存：在数据写入数据库的同时，同步更新缓存

如何更新缓存：
1. 写时更新缓存：写入数据库时同步更新缓存
2. 失效缓存：写入数据库后，删除缓存，下次读取时重新加载数据到缓存
3. 延迟双删：先删除缓存，再更新数据库，最后再次删除缓存，防止并发问题

缓存过期怎么办：
1. 设置缓存过期时间
2. 懒加载：下次请求触发时重新加载数据
3. 预加载：在缓存即将过期时，提前异步加载新数据

---
### 认证和授权

认证：验证用户身份，

授权：每个用户被分配一个角色，每个角色拥有特定的权限

---
### Cookie和Session
两种用于管理用户会话状态的技术。

1. Cookie是由服务器发送并在用户的浏览器中存储的小型文本文件。通常包含一些用户特定的信息，比如用户ID，偏好设置；
2. Session用来跟踪用户的状态，当用户与服务器建立连接时，服务器会创建一个唯一的Session ID，并将这个ID通过Cookie返回给客户端；Session数据存放在服务器端；

- Cookie保存在客户端，保存用户信息，比如偏好设置，购物车内容等。
- Session是通过服务端记录用户的状态，存储重要敏感信息，比如认证状态，用户角色等。

---
### OAuth 2.0
是一种授权框架，可以不用处理密码，授权另一个应用共享信息。

授权流程：
1. 授权码模式：最常用的模式，客户端首先将用户重定向到授权服务器，在用户同意后，客户端会从授权服务器收到一个授权码，然后使用授权码换取访问令牌。
2. 隐式许可类型：
3. 资源所有者凭据授予：
4. 客户端凭据授予：

---
### 定时任务如何实现？

1. 单机环境：
- ScheduledThreadPoolExecutor、ScheduledExecutorService 单机环境
- Spring @Schedule 单机环境
2. 分布式环境：
- Quartz
- xxl-job
- dolphinscheduler
3. 云原生环境：
- CronJob

---
### RateLimiter限流算法是如何工作的？

1. 令牌桶算法：系统以固定的速率向桶中添加令牌，每来一个请求就从桶中取走一个令牌
2. 漏桶算法：以固定的速率处理请求
3. 计数器算法：计算每个窗口内的请求数是否超过阈值

---
### 如何设计一个twitter系统，系统架构？

1. 首先分析功能需求
- 用户注册和登录
- 发布推文
- 关注用户
- 查看时间线，包括用户自己的推文和关注用户的推文
- 搜索推文或用户
- 推送通知（新关注、点赞消息）
2. 还有一些非功能需求
- 高并发支持：每秒百万次请求
- 低延迟：期望快速加载推文和时间线
- 可扩展性：系统能够动态扩展应对流量高峰
- 数据持久性和一致性：用户数据不会丢失，尽量保持一致性
- 容错性：即使部分服务失败，系统仍能正常运行
3. 系统架构设计
- 前端层：客户端、API Gateway：负责路由和负载均衡；提供统一的接口给前端调用；处理认证限流和缓存
- 后端服务：
  - 用户服务：用户注册、登录和用户信息
  - 推文服务：推文的增、删、查
  - 时间线服务：构建用户的时间线
  - 社交图谱服务：管理用户之间的关注关系
  - 搜索服务：提供全文搜索功能
  - 通知服务：实时推送通知
- 数据存储层
  - 关系型数据库：存储用户信息、配置数据等结构化数据
  - NoSQL：存储推文、时间线，Cassandra、MongoDB
  - 缓存：Redis存热点数据
  - 搜索引擎：Elasticsearch支持全文搜索
- 消息队列：用于异步处理任务，如推文发布、通知推送，解耦服务之间的直接依赖
- 文件存储：对象存储，存储图片、视频，AWS S3，Google Cloud Storage
- 监控与日志：Prometheus+Grafana监控系统性能；ELK(Elasticsearch,Logstash,Kibana)用于日志收集与分析
4. 时间线生成策略：
- 写扩散(write fan-out)：当用户发布一条推文时，将其推送到所有关注者的时间线缓存中
- 读扩散(read fan-out):当用户查看时间线时，实时从关注用户的推文中合并数据
5. 性能优化
- CDN：内容分发网络加速静态资源加载
- 数据压缩
- 分页和懒加载

---
### 如果一个Trace调用耗时比较长，怎么去进行排查
1. 使用分布式追踪系统组件，比如Zipkin，SkyWalking。找到耗时较长的Trace ID，分析其中每个Span（跨度）的时间消耗情况
2. 性能监控，查看日志记录，设置报警阈值

---
### 千万数据如何做排序的翻页查询
记录上一页的时间，然后再where条件里过滤这个时间，然后再limit 10分页

---
### 主函数调用了一个三个耗时很长的函数，函数之间无依赖关系，如何减少主函数的执行时间
改成异步调用。
1. 创建三个线程，每个线程执行对应任务。
2. 创建线程池，submit每个任务。
3. 使用CompletableFuture。CompletableFuture.allOf(f1, f2, f3).get();

---
### 如何设计一个uint64哈希算法，能把100长度以内的字符串转成hash值

---
### 读写并发，一个写线程多个读线程，如何解决并发冲突？
- 允许多个读线程同时读取；
- 写线程独占资源，其他线程（包括读线程）必须等待

---
### 电商系统中如何解决高并发下的超卖问题？
1. 乐观锁(CAS+版本号，如update stock set count = count - 1 where id = xxx and count >= 1)
2. 分布式锁（Redis的Redisson或Zookeeper实现）
3. 预扣库存(Redis扣减+消息队列异步落库)
4. 限流(Sentinel或Guava RateLimiter)

---
### 使用乐观锁解决超卖问题时，是否有性能挑战(如大量并发下的旋转等待影响响应速度？)有无优化措施？
是的，如果有频繁发生冲突，可能导致大量的重试操作和旋转等待。

优化：
1. 限制最大重试次数
2. 指数退避，每次重试，增加等待时间
3. 限流

---
### 乐观锁在高并发场景下可能有什么问题？
乐观锁的原理不加锁，而是通过版本号或时间戳等机制来检测数据是否被其他事务修改过

---
### 如何设计一个秒杀系统
1. 分层削峰：前端限流(验证码)、中间层缓存(Redis)、后端队列(Kafka异步处理)
2. 热点数据隔离：Redis集群分片存储商品库存
3. 无状态服务：服务拆分(秒杀服务独立部署)
4. 降级策略：熔断(如Hystrix)

---
### 订单号生成有什么方案？如何保证全局唯一？
1. snowflake算法，时间戳+机器ID+序列号
2. 数据库自增
3. UUID
4. 业务拼接

---
### 电商的优惠券系统如何实现？
1. 数据模型：优惠券模板、用户领劵记录、券状态
2. 并发问题：用户领券时用redis的INCR防超发
3. 核销流程：幂等性设计(如订单ID+券ID唯一索引)

---
### 如何实现购物车功能
1. 未登录用户：用redis的Hash结果存储(key=临时ID，field=SKU_ID，value=商品数量)
2. 已登录用户：数据同步到MySQL，缓存双写
3. 合并逻辑：用户登录后合并临时购物车和DB购物车

---
### 分布式事务在订单支付场景如何应用？
1. 消息队列：本地消息表+RocketMQ事务消息
2. 最大努力通知：支付回调+重试机制

---
### 电商系统如何做性能监控
1. 链路追踪：Skywalking/Pinpoint追踪微服务调用链
2. 指标监控：Prometheus+Grafana监控QPS，RT
3. 日志分析：ELK收集异常日志
4. JVM调优：Arthas诊断线上问题

---
### 拓扑排序

---
### 介绍洗牌算法，就是现在有一个数组，要将顺序随机打乱，如何实现？
1. 从最后一个元素往前遍历
2. 对于当前元素，随机选择一个范围在[0,当前索引]的一个索引
3. 将当前元素，与目标索引的元素交换位置，
4. 向前一步，直到遍历完所有元素。

---
### 尾递归

---
### git merge 和 git rebase 区别

---
### git rebase什么意思
合并多个commit

---
### cherry pick是什么命令

---
### 自己实现lru

---
### 怎么理解责任链模式

---
### 享元模式

---
### 64匹马，8个赛道，如何选出最快的四匹？
10或11

---
### 给定一个16bit的随机数生成函数，实现一个64bit的随机数生成函数
result = (result << 16) | random16()

通过左移，再按位或，拼接4个

---
### 给定整形的随机生成函数，比如random64，实现一个浮点型的随机数生成函数，这个函数输入一个范围，比如a，b，表示大于等于a，小于b之间的随机浮点数。a和b本身也是浮点数
1. 先用给定的随机数生成函数生成一个随机数
2. 然后将该随机数归一化为[0.0, 1.0)之间的一个小数 unit
3. 然后映射到[a,b)的范围：  a + (b-1) * unit

---
### 加权随机，在N个对象当中随机的选择，每个对象有一个概率权重，怎么实现？
1. 计算出权重总和
2. 随机生成一个数
3. 判断该数落在哪个对象上

---
### 服务器有1T的数据，磁盘总空间不止一个T，1T数据中有很多字符串组成的，从这些数据中找出出现次数最高的前1000个
如果使用Spark来做，就可以很快

思想是：MapReduce的思想。分成很多个小文件，对每个小文件统计词频，最后reduce

---
### 两个文件，每个文件有10亿个URL，给你一个内存很小的计算机，找出两个文件中相等的URL？(分治思想+分片哈希)
- 将A文件分成N个文件
- 将B文件也分成N个文件 并且使用同一个hash函数分片，这样相同的URL会被分到同一个下标的小文件中。
- 一对一对比较A中的小文件和B中的小文件。选出所有相同的URL。

---
### xxljob，一个任务执行耗时很长，会怎么处理？

---
### 有10亿数据，找出最大的100个(考虑内存与不考虑内存)
最小堆

---
### 怎么设计RPC

---
### 两个字符串都是用数字组成的，对两个数字做加法，如果字符串超大怎么写?
模拟加法，从后往前加法，用carry表示进位

---
### 很大的数据，但是只有很小的内存，怎么排序

---
### java实现用户短视频一分钟只能最多有10个点赞

---
### 智力题：烧绳子，不均匀的一根绳子烧完需要1小时，如何计时15分钟，30分钟，45分钟
1. 半小时:从两端开始烧，烧完的时间就是半小时
2. 15分钟：取两个绳子，一根从两端烧，另一根从一端烧；当第一根烧完时，熄灭第二根，此时第二根在从两端烧就是15分钟
3. 45分钟：上面两个步骤的时间就是45分钟

---
### 电脑微信扫码登录的实现？三端请求的过程？

---
### 发布服务的时候，怎么预热服务？
- 提前加载缓存
- 数据库的连接池预热
- redis将热点数据加载到缓存中
- innodb存储引擎有buffer_pool，缓存池，可以进行数据库的预热。

---
### 实现分布式锁

---
### 设计聊天室，功能设计 数据库设计 并发处理 压缩消息 如何提升并发量 如何确定消息的有序和一致性 消息批量发送


---
### 在高并发场景下的限流 容灾 如何对业务进行取舍
